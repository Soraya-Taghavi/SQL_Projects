SELECT 
  *
FROM
  Teca.teca;

---•  Sales and Revenue Analysis:
--- 1. What is the total revenue generated per site?
SELECT 
  site_name,
  ROUND(SUM(revenue), 2) as total_revenue
FROM 
  Teca.teca
GROUP BY
  site_name;

--- 2. Which 3 product category generates the highest revenue?
SELECT 
  category_name,
  ROUND(SUM(revenue), 2) as total_revenue
FROM 
  Teca.teca
GROUP BY
  category_name
ORDER BY 
  2 DESC
LIMIT 
  3;

---3. What is the average gross profit per transaction?
SELECT 
  ROUND(AVG(gross_profit), 2) as average_gross_profit_per_transaction
FROM
  Teca.teca;

---4. What are the total costs associated with each product category?
SELECT
  category_name,
  ROUND(SUM(costs), 2) as total_costs
FROM
  Teca.teca
GROUP BY
  category_name
ORDER BY
  2 DESC;

  --- •  Product Performance:
  ---1. Which product is the best-seller in terms of units sold?
SELECT
  product_name,
  ROUND(SUM(units), 2) as units_sold
FROM
  Teca.teca
GROUP BY
  product_name
ORDER BY
  2 DESC
LIMIT
  1;

---2. What is the total revenue generated by each product?
SELECT
  product_name,
  ROUND(SUM(revenue), 2) as total_revenue
FROM
  Teca.teca
GROUP BY
  product_name
ORDER BY
  2 DESC;

  ---3. How does the gross profit margin vary across different products?

SELECT
  product_name,
  ROUND(AVG(gross_profit) / AVG(revenue) * 100, 2) as gross_profit_margin
FROM
  Teca.teca
GROUP BY
  product_name
HAVING 
  AVG(revenue) != 0
ORDER BY
  2 DESC;

---4. What are the top 5 products with the highest gross profit?

SELECT
  product_name,
  ROUND(SUM(gross_profit), 2) as gross_profit
FROM
  Teca.teca
GROUP BY
  product_name
ORDER BY
  2 DESC
LIMIT 
  5;

--- •  Site and Location Analysis:
---1. Which site has the highest number of transactions?
SELECT
  site_name,
  COUNT(DISTINCT transaction_id) as number_of_transactions
FROM 
  Teca.teca
GROUP BY
  site_name
ORDER BY
  2 DESC
LIMIT 1;

---2.	What is the average revenue per transaction for each site?
SELECT
  site_name,
  ROUND(AVG(revenue), 2) as avg_revenue
FROM
  Teca.teca
GROUP BY
  site_name
ORDER BY
  avg_revenue DESC;

--- 3.	How does the performance of sites vary by city?
SELECT
  site_name,
  city,
  ROUND(SUM(revenue), 2) as total_revenue,
  ROUND(SUM(gross_profit), 2) as total_gross_profit
FROM
  Teca.teca
GROUP BY
  city,
  site_name
ORDER BY
  city,
  total_revenue DESC,
  total_gross_profit DESC;

---•  Time-Based Analysis:
---1.	What are the monthly sales trends for the past year?
WITH Last_year AS (
  SELECT
    MAX(DATE_TRUNC(unformatted_date, YEAR)) AS year
  FROM 
    Teca.teca
)
SELECT
  DATE_TRUNC(unformatted_date, MONTH) AS month,
  ROUND(SUM(revenue), 2) AS total_revenue,
  ROUND(SUM(gross_profit), 2) AS total_gross_profit
FROM
  Teca.teca,
  Last_year
WHERE
  DATE_TRUNC(unformatted_date, YEAR) = Last_year.year
GROUP BY 
  month
ORDER BY 
  month;

---2.	How does revenue vary across different days of the week?
SELECT
  CASE EXTRACT(DAYOFWEEK FROM unformatted_date)
    WHEN 1 THEN 'Sunday'
    WHEN 2 THEN 'Monday'
    WHEN 3 THEN 'Tuesday'
    WHEN 4 THEN 'Wednesday'
    WHEN 5 THEN 'Thursday'
    WHEN 6 THEN 'Friday'
    WHEN 7 THEN 'Saturday'
  END AS dow,
  ROUND(SUM(revenue), 2) AS total_revenue,
  ROUND(AVG(revenue), 2) AS avg_revenue
FROM
  Teca.teca
GROUP BY 
  dow
ORDER BY 
  CASE 
    WHEN dow = 'Sunday' THEN 1
    WHEN dow = 'Monday' THEN 2
    WHEN dow = 'Tuesday' THEN 3
    WHEN dow = 'Wednesday' THEN 4
    WHEN dow = 'Thursday' THEN 5
    WHEN dow = 'Friday' THEN 6
    WHEN dow = 'Saturday' THEN 7
  END;

  ---3.	What is the peak time of the year for sales?
SELECT
  CASE EXTRACT(MONTH FROM unformatted_date)
    WHEN 1 THEN 'January'
    WHEN 2 THEN 'February'
    WHEN 3 THEN 'March'
    WHEN 4 THEN 'April'
    WHEN 5 THEN 'May'
    WHEN 6 THEN 'June'
    WHEN 7 THEN 'July'
    WHEN 8 THEN 'Augest'
    WHEN 9 THEN 'September'
    WHEN 10 THEN 'October'
    WHEN 11 THEN 'November'
    WHEN 12 THEN 'December'
  END as month_name,   
  ROUND(SUM(revenue), 2) as total_revenue
FROM
  Teca.teca  
GROUP BY
  month_name
ORDER BY
  total_revenue DESC
LIMIT 
  1;

---•  Category and Parent Category Analysis:
---1.	What is the revenue contribution of each category?
SELECT 
  SUM(revenue) as total_revenue
FROM 
  Teca.teca;

SELECT
  category_name,
  ROUND((SUM(revenue) / 24001.489999999951 * 100), 2) as revenue_contribution
FROM
  Teca.teca
GROUP BY
  category_name
ORDER BY
  revenue_contribution DESC;

---2.	Which parent category has the highest number of transactions?
SELECT
  parent_name,
  COUNT(transaction_id) as number_of_transactions
FROM
  Teca.teca
GROUP BY
  parent_name
ORDER BY
  number_of_transactions DESC
LIMIT 1;

---3.	How do product counts vary across different categories?

SELECT
  category_name,
  AVG(product_count) as product_counts
FROM
  Teca.teca
GROUP BY
  category_name
ORDER BY
  2 DESC;


---4.	What is the relationship between parent categories and their respective categories in terms of revenue?

SELECT
  parent_name,
  category_name,
  ROUND(AVG(revenue), 2) as Avg_revenue
FROM
  Teca.teca
GROUP BY
  parent_name,
  category_name
ORDER BY
  parent_name,
  Avg_revenue DESC;





